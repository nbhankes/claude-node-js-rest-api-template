# =============================================================================
# ENVIRONMENT CONFIGURATION TEMPLATE
# =============================================================================
# Copy this file to .env and fill in your actual values.
# NEVER commit your .env file to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# ANTHROPIC API CONFIGURATION
# -----------------------------------------------------------------------------
# Your Anthropic API key - obtain from https://console.anthropic.com/
# Required: Yes
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# Default Claude model to use for API requests
# Available models: claude-opus-4-5-20251101, claude-sonnet-4-20250514, claude-3-5-haiku-20241022
# Required: No (defaults to claude-sonnet-4-20250514)
DEFAULT_MODEL=claude-sonnet-4-20250514

# Default maximum tokens for API responses (controls response length)
# Users can override this per-request up to HARD_MAX_TOKENS
# Required: No (defaults to 1024)
DEFAULT_MAX_TOKENS=1024

# COST PROTECTION: Hard maximum token limit
# This is the absolute maximum that cannot be exceeded by any request
# Set this lower for cost-sensitive deployments
# Required: No (defaults to 4096)
HARD_MAX_TOKENS=4096

# SECURITY: Maximum prompt length in characters
# Prevents extremely long prompts that could abuse token limits
# ~4 characters ≈ 1 token, so 50000 chars ≈ 12500 tokens max input
# Required: No (defaults to 50000)
MAX_PROMPT_LENGTH=50000

# Maximum system prompt length in characters
# Required: No (defaults to 10000)
MAX_SYSTEM_PROMPT_LENGTH=10000

# -----------------------------------------------------------------------------
# RETRY CONFIGURATION
# -----------------------------------------------------------------------------
# Maximum number of retry attempts for failed API calls
# Required: No (defaults to 3)
API_MAX_RETRIES=3

# Base delay between retries in milliseconds (uses exponential backoff)
# Required: No (defaults to 1000)
API_RETRY_BASE_DELAY_MS=1000

# Maximum delay between retries in milliseconds
# Required: No (defaults to 10000)
API_RETRY_MAX_DELAY_MS=10000

# -----------------------------------------------------------------------------
# CIRCUIT BREAKER CONFIGURATION
# -----------------------------------------------------------------------------
# Number of consecutive failures before opening the circuit
# Required: No (defaults to 5)
CIRCUIT_BREAKER_THRESHOLD=5

# Time in milliseconds to wait before trying again after circuit opens
# Required: No (defaults to 30000)
CIRCUIT_BREAKER_RESET_MS=30000

# -----------------------------------------------------------------------------
# SERVER CONFIGURATION
# -----------------------------------------------------------------------------
# Port number for the Express server
# Required: No (defaults to 3000)
PORT=3000

# Node environment (development, production, test)
# Required: No (defaults to development)
NODE_ENV=development

# Request timeout in milliseconds
# Required: No (defaults to 60000)
REQUEST_TIMEOUT_MS=60000

# Maximum request body size
# Required: No (defaults to 10kb)
MAX_BODY_SIZE=10kb

# -----------------------------------------------------------------------------
# RATE LIMITING CONFIGURATION
# -----------------------------------------------------------------------------
# General rate limiting (applies to all endpoints)
# Maximum number of requests per window per IP
# Required: No (defaults to 100)
RATE_LIMIT_MAX=100

# Time window for rate limiting in minutes
# Required: No (defaults to 15)
RATE_LIMIT_WINDOW_MINUTES=15

# Stricter rate limiting for Claude API endpoints (cost protection)
# This is SEPARATE from general rate limiting and applies only to
# /api/affirmations/* and /api/emotions/* endpoints
# Required: No (defaults to 30)
CLAUDE_API_RATE_LIMIT_MAX=30

# Time window for Claude API rate limiting in minutes
# Required: No (defaults to 15)
CLAUDE_API_RATE_LIMIT_WINDOW_MINUTES=15

# -----------------------------------------------------------------------------
# SECURITY CONFIGURATION (Single API Key Authentication)
# -----------------------------------------------------------------------------
# This template uses a simple single-key authentication system.
# One API key is stored here and compared against incoming requests.
#
# HOW IT WORKS:
# 1. Set REQUIRE_API_KEY=true to enable authentication
# 2. Set API_KEY to a secure random string
# 3. Clients must include the key in requests: -H "X-API-Key: your-key"
# 4. The /api/validate endpoint can be used to test if a key is valid
#
# GENERATING A SECURE KEY:
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#   openssl rand -hex 32
#
# Example key (DO NOT USE - generate your own!):
#   API_KEY=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456

# Whether to require API key authentication for /api/* endpoints
# Set to true in production to protect your API
# Required: No (defaults to false)
REQUIRE_API_KEY=false

# Your API key - clients must send this in the X-API-Key header
# Generate a secure random key using the commands above
# Required: Only if REQUIRE_API_KEY=true
API_KEY=your_api_key_here

# Trusted proxy count (for rate limiting behind reverse proxy)
# Set to 1 if behind one proxy (nginx, AWS ALB, etc.)
# Required: No (defaults to 1)
TRUST_PROXY=1

# -----------------------------------------------------------------------------
# CORS CONFIGURATION
# -----------------------------------------------------------------------------
# Allowed origins for CORS (comma-separated for multiple)
# Use specific domain in production, not '*'
# Examples: https://myapp.com, https://www.myapp.com
# Required: No (defaults to *)
CORS_ORIGIN=*

# -----------------------------------------------------------------------------
# LOGGING CONFIGURATION
# -----------------------------------------------------------------------------
# Log level: combined, common, dev, short, tiny
# Use 'combined' in production for full request details
# Required: No (defaults to dev)
LOG_FORMAT=dev

# =============================================================================
# PRODUCTION CHECKLIST
# =============================================================================
# Before deploying to production, ensure you have:
#
# 1. Set ANTHROPIC_API_KEY to your production API key
# 2. Set NODE_ENV=production
# 3. Set REQUIRE_API_KEY=true and generate a strong API_KEY
# 4. Set CORS_ORIGIN to your specific frontend domain(s)
# 5. Set HARD_MAX_TOKENS to control maximum costs per request
# 6. Set CLAUDE_API_RATE_LIMIT_MAX to control costs over time
# 7. Set LOG_FORMAT=combined for full request logging
# 8. Consider lowering DEFAULT_MAX_TOKENS for cost efficiency
# =============================================================================
